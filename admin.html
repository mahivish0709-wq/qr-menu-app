<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>管理画面</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body style="text-align:center; padding-top:50px; font-family:sans-serif;">

    <h2>メニュー登録</h2>
    <div style="margin-bottom:20px;">
        <input id="n" type="text" value="牛丼" style="font-size:18px; padding:10px;">
        <input id="p" type="number" value="800" style="font-size:18px; padding:10px; width:80px;">
    </div>

    <button id="b" style="font-size:25px; padding:20px 40px; background:green; color:white; border-radius:10px; cursor:pointer;"
        onclick="registerMenu()">
        登録を実行する
    </button>

    <script>
        async function registerMenu() {
            const btn = document.getElementById('b');
            
            // 道具箱が準備できているかチェック
            if (typeof supabase === 'undefined' && typeof supabasejs === 'undefined') {
                alert('準備中です。3秒待ってからもう一度押してください。');
                return;
            }

            const URL = 'https://ooyvztatkhadbquwimhz.supabase.co';
            const KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9veXZ6dGF0a2hhZGJxdXdpbWh6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3MjAxNTQsImV4cCI6MjA4NDI5NjE1NH0.8j_E3GTtXfe0ufDVksZhjHYfWVQIGw6nino80USV8no';
            
            btn.innerText = '送信中...';
            btn.style.background = 'gray';

            try {
                // supabasejs または supabase のどちらでも動くように調整
                const createClient = (typeof supabasejs !== 'undefined') ? supabasejs.createClient : supabase.createClient;
                const client = createClient(URL, KEY);
                
                const name = document.getElementById('n').value;
                const price = document.getElementById('p').value;

                const { error } = await client
                    .from('menus')
                    .insert([{ name_ja: name, price: parseInt(price) }]);

                if (error) {
                    alert('エラー: ' + error.message);
                    btn.innerText = '失敗（やり直す）';
                    btn.style.background = 'red';
                } else {
                    alert('✅ 成功！！\n牛丼が登録されました！');
                    btn.innerText = '登録完了！';
                    btn.style.background = 'blue';
                }
            } catch (e) {
                alert('エラー発生: ' + e.message);
                btn.innerText = 'やり直す';
                btn.style.background = 'orange';
            }
        }
    </script>
</body>
</html>
